TARGET_DIST_NAME = XCSoar-$(FULL_VERSION)-$(TARGET)
TARGET_DIST_DIR = $(TARGET_OUTPUT_DIR)/dist

DIST_DEPS = $(XCSOAR_BIN) $(VALI_XCS_BIN)

ifeq ($(HAVE_WIN32)$(FREETYPE),yy)
DIST_DEPS += $(FONT_TARGETS)
endif

dist: $(DIST_DEPS)
	rm -rf $(TARGET_DIST_DIR)/$(TARGET_DIST_NAME)
	$(MKDIR) -p $(TARGET_DIST_DIR)/$(TARGET_DIST_NAME)
	cp $(XCSOAR_BIN) $(VALI_XCS_BIN) COPYING \
		$(TARGET_DIST_DIR)/$(TARGET_DIST_NAME)/
ifeq ($(HAVE_WIN32)$(FREETYPE),yy)
	$(MKDIR) -p $(TARGET_DIST_DIR)/$(TARGET_DIST_NAME)/fonts
	cp $(FONT_TARGETS) \
		$(TARGET_DIST_DIR)/$(TARGET_DIST_NAME)/fonts/
endif
	cd $(TARGET_DIST_DIR) && $(ZIP) -r $(TARGET_DIST_NAME).zip $(TARGET_DIST_NAME)
	mv $(TARGET_DIST_DIR)/$(TARGET_DIST_NAME).zip $(OUT)/
